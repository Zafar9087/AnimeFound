<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Anime Found</title>
    <link rel="icon" href="Flux_Dev_Create_a_logo_on_a_bold_fire_engine_red_background_wi_2.jpeg" image>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            background-image: url(Bleu.jpg);
            background-position: center;
            background-size: cover;
            background-repeat: no-repeat;
            color: white;
            margin: 0;
            padding: 0;
            min-height: 100px;
            display: flex;
            flex-direction: column;
        }

        #navbar {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            background: linear-gradient(45deg, #0e2553, #0d253f);
            padding: 15px;
            font-size: 15px;
            font-weight: bold;
            z-index: 1000;
        }

        #content {
            flex-grow: 1;
            margin-top: 80px;
            margin-bottom: 80px;
            padding: 20px;
        }

        #anime-container {
            width: 80%; /* Уменьшение контейнера */
            max-width: 600px;
            margin: auto;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border-radius: 15px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            padding: 20px;
            box-shadow: 0 4px 30px rgba(0, 0, 0, 0.1);
            transform: scale(0.9); /* Эффект уменьшения */
            transform-origin: center;
        }

        img {
            width: 80%;
            border-radius: 15px;
            max-width: 350px;
            height: auto;
            object-fit: cover;
        }

        button {
            margin: 8px;
            padding: 15px 25px;
            font-size: 15px;
            cursor: pointer;
            border: none;
            border-radius: 8px;
            transition: 0.3s;
        }

        .watched { background-color: #4CAF50; color: white; }
        .not-watched { background-color: #f44336; color: white; }
        .restart { background-color: #008CBA; color: white; display: none; margin-top: 20px; }

        button:active {
            filter: brightness(1.3);
        }

        #not-watched-container {
            display: none;
            flex-wrap: wrap;
            justify-content: center;
            align-items: center;
            margin-top: 20px;
        }

        .anime-item {
            margin: 15px;
            text-align: center;
        }

        .anime-item img {
            width: 200px;
            height: 100px;
        }

        #not-watched-title {
            font-size: 28px;
            font-weight: bold;
            margin-bottom: 20px;
            display: none;
        }

        #footer {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            background: linear-gradient(45deg, #0e2553, #0d253f);
            padding: 15px;
            text-align: center;
            font-size: 15px;
        }

        @media (max-width: 768px) {
            #anime-container {
                width: 90%; /* Для мобильных устройств увеличиваем ширину */
            }
        }
        .top-bar-btn {
            background: linear-gradient(90deg, #4da6ff 0%, #1c75d8 100%);
            color: #fff;
            border: none;
            border-radius: 20px;
            font-size: 1em;
            padding: 10px 20px;
            cursor: pointer;
            font-weight: bold;
            box-shadow: 0 2px 8px rgba(0,0,0,0.3);
            transition: background 0.2s, transform 0.2s;
            text-decoration: none;
            display: inline-block;
        }
        .more-dropdown {
            position: absolute;
            top: calc(100% + 5px);
            right: 0;
            background: rgba(10, 15, 26, 0.8);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            padding: 10px;
            display: flex;
            flex-direction: column;
            gap: 10px;
            border-radius: 12px;
            border: 1px solid rgba(77, 166, 255, 0.1);
            box-shadow: 0 8px 16px rgba(0,0,0,0.2);
            opacity: 0;
            transform: translateY(-10px);
            transition: opacity 0.2s ease-out, transform 0.2s ease-out;
            pointer-events: none;
        }
        .more-dropdown.visible {
            opacity: 1;
            transform: translateY(0);
            pointer-events: auto;
        }
    </style>
</head>
<body>
    <div id="navbar">
        Игра: Смотрел ли ты это аниме?
    </div>
    
    <div id="content">
        <div id="anime-container">
            <h2 id="anime-title">Загрузка...</h2>
            <img id="anime-image" src="" alt="Anime Image">
            <p id="anime-description">Описание загружается...</p>
            <button class="watched" onclick="markAsWatched()">Смотрел</button>
            <button class="not-watched" onclick="markAsNotWatched()">Не смотрел</button>
            <p>Жизней: <span id="lives">3</span></p>
        </div>

        <div id="not-watched-title">Ты не смотрел аниме</div>
        <div id="not-watched-container"></div>
        <button class="restart" onclick="restartGame()">Начать раунд заново</button>
    </div>

    <div id="footer">© 2025 Игра по мотивам аниме</div>
     
    <script>
        const API_URL = "https://shikimori.one/api/animes";
        let lives = 3;
        let shownAnimes = new Set();
        let currentAnime = null;
        let notWatchedAnimes = []; // Массив для хранения неугаданных аниме
        let watchedCount = 0;

        document.addEventListener("DOMContentLoaded", () => {
            getRandomAnime();
        });

        async function getRandomAnime() {
            try {
                const response = await fetch(`${API_URL}?order=ranked&limit=50`);
                const data = await response.json();
                const filteredAnime = data.filter(anime => 
                    !["movie", "kids", "avant_garde", "historical", "special", "ova"].includes(anime.kind) &&
                    !shownAnimes.has(anime.id)
                );
                
                if (filteredAnime.length === 0) {
                    alert("Все аниме были показаны!");
                    return;
                }
                
                currentAnime = filteredAnime[Math.floor(Math.random() * filteredAnime.length)];
                shownAnimes.add(currentAnime.id);
                
                document.getElementById("anime-title").textContent = currentAnime.russian || currentAnime.name;
                document.getElementById("anime-image").src = `https://shikimori.one${currentAnime.image.original}`;
                document.getElementById("anime-description").textContent = currentAnime.description || "Описание отсутствует.";
            } catch (error) {
                console.error("Ошибка при загрузке аниме:", error);
            }
        }

        function markAsWatched() {
            watchedCount++;
            getRandomAnime();
        }

        function markAsNotWatched() {
            if (lives > 0) {
                lives--;
                document.getElementById("lives").textContent = lives;
                notWatchedAnimes.push(currentAnime); // Добавляем неугаданное аниме в массив

                if (lives === 0) {
                    endRound();
                } else {
                    getRandomAnime();
                }
            }
        }

        function endRound() {
            const user = JSON.parse(localStorage.getItem('googleUser'));
            if (user) {
                let userProfile = JSON.parse(localStorage.getItem(user.sub)) || { xp: 0, favorites: [], planToWatch: [], watching: [], watched: [] };
                userProfile.xp += watchedCount;
                localStorage.setItem(user.sub, JSON.stringify(userProfile));
            }

            // Показываем все неугаданные аниме горизонтально
            const notWatchedContainer = document.getElementById("not-watched-container");
            notWatchedContainer.innerHTML = ""; // Очистить контейнер

            notWatchedAnimes.forEach(anime => {
                const animeItem = document.createElement("div");
                animeItem.classList.add("anime-item");

                const img = document.createElement("img");
                img.src = `https://shikimori.one${anime.image.original}`;
                animeItem.appendChild(img);

                const title = document.createElement("h3");
                title.textContent = anime.russian || anime.name;
                animeItem.appendChild(title);

                notWatchedContainer.appendChild(animeItem);
            });

            document.getElementById("anime-container").style.display = "none";
            document.getElementById("not-watched-title").style.display = "block";
            document.getElementById("not-watched-container").style.display = "flex";
            document.querySelector(".restart").style.display = "block";
        }

        function restartGame() {
            lives = 3;
            shownAnimes.clear();
            notWatchedAnimes = []; // Очистить массив неугаданных аниме
            watchedCount = 0;
            document.getElementById("lives").textContent = lives;
            document.getElementById("anime-container").style.display = "block";
            document.getElementById("not-watched-title").style.display = "none";
            document.getElementById("not-watched-container").style.display = "none";
            document.querySelector(".restart").style.display = "none";
            getRandomAnime();
        }

        document.getElementById('moreBtn').addEventListener('click', function() {
            const dropdown = document.getElementById('more-buttons-dropdown');
            dropdown.classList.toggle('visible');
        });

        document.getElementById('more-buttons-dropdown').addEventListener('click', function(event) {
            if (event.target.tagName === 'A' || event.target.tagName === 'BUTTON') {
                this.classList.remove('visible');
            }
        });
      </script>
</body>
</html>
